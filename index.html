<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Viral Deals PH — Landing + Affiliate Store</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>/* small custom styles */
    .card-img { height:180px; object-fit:cover; width:100%; }
    .thumb { width:120px; height:120px; object-fit:cover; border-radius:8px; }
    .gallery-img { max-width:100%; display:block; margin-bottom:12px; }
  </style>
</head>
<body class="bg-slate-50 text-slate-800">
  <!-- HERO / LANDING -->
  <header class="bg-gradient-to-r from-green-400 to-emerald-500 text-white p-6">
    <div class="max-w-5xl mx-auto flex items-center justify-between">
      <div>
        <h1 id="brand" class="text-3xl font-extrabold">Viral Deals PH</h1>
        <p class="opacity-90 mt-1">Trending deals & handpicked affiliate finds — click to buy on the store you prefer.</p>
      </div>
      <div class="space-x-2">
        <button id="addBtn" class="bg-white text-emerald-600 px-4 py-2 rounded shadow">Add product</button>
        <button id="importBtn" class="bg-white text-emerald-600 px-4 py-2 rounded shadow">Import CSV</button>
        <button id="exportBtn" class="bg-white text-emerald-600 px-4 py-2 rounded shadow">Export JSON</button>
      </div>
    </div>
  </header>

  <main class="max-w-5xl mx-auto p-4">
    <section class="my-6 grid grid-cols-1 md:grid-cols-4 gap-4">
      <div class="md:col-span-3">
        <h2 class="text-xl font-bold mb-2">Latest Deals</h2>
        <div id="productsGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"></div>
      </div>
      <aside class="bg-white p-4 rounded shadow md:col-span-1">
        <h3 class="font-semibold">About this store</h3>
        <p class="mt-2 text-sm">This landing + store is ready to use. Add products with affiliate links (Shopee, Lazada, Shein, Amazon). Clicking a product "Buy" button opens the affiliate link in a new tab.</p>
        <hr class="my-3" />
        <p class="text-sm">Quick tips:</p>
        <ul class="text-sm list-disc list-inside mt-2">
          <li>Edit the brand name at the top of the file (search for <code>BRAND_NAME</code>)</li>
          <li>Use the Add product button to add single items, or Import CSV to bulk upload.</li>
          <li>Host on GitHub Pages / Netlify / Vercel — or just open the HTML file locally.</li>
        </ul>
      </aside>
    </section>
  </main>

  <!-- MODAL: Add Product -->
  <div id="modal" class="fixed inset-0 flex items-center justify-center bg-black/40 hidden">
    <div class="bg-white rounded-lg shadow-lg w-full max-w-xl p-6">
      <h3 class="text-lg font-bold">Add / Edit Product</h3>
      <form id="productForm" class="mt-4 space-y-3">
        <input id="pId" type="hidden">
        <div>
          <label class="block text-sm">Product name</label>
          <input id="pName" class="w-full border rounded p-2" required />
        </div>
        <div>
          <label class="block text-sm">Price (optional)</label>
          <input id="pPrice" class="w-full border rounded p-2" />
        </div>
        <div>
          <label class="block text-sm">Affiliate link (required)</label>
          <input id="pLink" class="w-full border rounded p-2" required />
        </div>
        <div>
          <label class="block text-sm">Category (optional)</label>
          <input id="pCategory" class="w-full border rounded p-2" />
        </div>
        <div>
          <label class="block text-sm">Image URLs (comma-separated)</label>
          <input id="pImages" class="w-full border rounded p-2" placeholder="https://img1.jpg, https://img2.jpg" />
        </div>
        <div>
          <label class="block text-sm">Or upload multiple images</label>
          <input id="pFiles" type="file" accept="image/*" class="w-full" multiple />
        </div>
        <div class="flex gap-2 justify-end">
          <button type="button" id="cancelBtn" class="px-4 py-2 rounded bg-slate-200">Cancel</button>
          <button type="submit" class="px-4 py-2 rounded bg-emerald-500 text-white">Save product</button>
        </div>
      </form>
    </div>
  </div>

  <!-- HIDDEN CSV INPUT -->
  <input id="csvInput" type="file" accept=".csv" class="hidden" />

  <script>
    // ====== CONFIG: change this brand text if you want ======
    const BRAND_NAME = 'Viral Deals PH'; // edit this value
    document.getElementById('brand').textContent = BRAND_NAME;

    // ====== Data storage ======
    // switched key to reset old products
    const STORAGE_KEY = 'vd_products_v2';
    function loadProducts(){
      try{ return JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]'); }catch(e){ return []; }
    }
    function saveProducts(list){ localStorage.setItem(STORAGE_KEY, JSON.stringify(list)); }

    // ====== UI Helpers ======
    function el(tag, attrs={}, children=[]) { const e = document.createElement(tag); Object.assign(e, attrs); (Array.isArray(children)?children:[children]).forEach(c=>{ if(!c) return; if(typeof c === 'string') e.appendChild(document.createTextNode(c)); else e.appendChild(c); }); return e; }

    function renderImageList(imgs){ if(!imgs||imgs.length===0) return el('img',{src:'https://via.placeholder.com/600x400?text=No+Image',className:'card-img'});
      const container = el('div',{className:'flex overflow-x-auto gap-2 p-2'});
      imgs.forEach(url=>{
        container.appendChild(el('img',{src:url,className:'thumb'}));
      });
      return container;
    }

    function renderProducts(){
      const grid = document.getElementById('productsGrid'); grid.innerHTML='';
      const products = loadProducts().slice().reverse(); // newest first
      if(products.length===0){ grid.appendChild(el('div',{className:'p-6 bg-white rounded shadow col-span-full'},[el('p',{},'No products yet — click Add product to add affiliates or import a CSV.')])) }
      products.forEach((p,i)=>{
        const card = el('div',{className:'bg-white rounded shadow overflow-hidden flex flex-col'});
        const img = el('div',{onclick:()=>openGallery(p.images),className:'cursor-pointer'},[ el('img',{src:(p.images&&p.images[0])||'https://via.placeholder.com/600x400?text=No+Image',className:'card-img'}) ]);
        const body = el('div',{className:'p-3 flex-1 flex flex-col'});
        body.appendChild(el('h4',{className:'font-semibold'},p.name||'Untitled'));
        body.appendChild(el('p',{className:'text-sm mt-1 flex-1'},p.category?('Category: '+p.category):'') );
        body.appendChild(el('div',{className:'mt-2 flex items-center justify-between'},[
          el('span',{className:'font-bold'}, p.price?('₱'+p.price):''),
          el('div',{className:'flex gap-2'},[
            el('a',{href:p.link||'#',target:'_blank',rel:'noopener',className:'px-3 py-1 rounded bg-emerald-500 text-white text-sm'},'Buy'),
            el('button',{className:'px-2 py-1 rounded border text-sm',onclick:()=>editProduct(p.id)},'Edit'),
            el('button',{className:'px-2 py-1 rounded border text-sm',onclick:()=>deleteProduct(p.id)},'Delete')
          ])
        ]));
        card.appendChild(img); card.appendChild(body);
        grid.appendChild(card);
      })
    }

    // ====== CRUD ======
    function addProduct(data){ const list = loadProducts(); data.id = Date.now().toString(); list.push(data); saveProducts(list); renderProducts(); }
    function updateProduct(id, data){ const list = loadProducts(); const idx = list.findIndex(x=>x.id===id); if(idx>-1){ list[idx] = {...list[idx], ...data}; saveProducts(list); renderProducts(); } }
    function deleteProduct(id){ if(!confirm('Delete this product?')) return; const list = loadProducts().filter(x=>x.id!==id); saveProducts(list); renderProducts(); }
    function editProduct(id){ const list = loadProducts(); const p = list.find(x=>x.id===id); if(!p) return; openModal(p); }

    // ====== Modal form ======
    const modal = document.getElementById('modal'); const productForm = document.getElementById('productForm');
    document.getElementById('addBtn').addEventListener('click', ()=>openModal());
    document.getElementById('cancelBtn').addEventListener('click', closeModal);

    function openModal(p=null){ modal.classList.remove('hidden'); document.body.style.overflow='hidden';
      document.getElementById('pId').value = p? p.id : '';
      document.getElementById('pName').value = p? p.name : '';
      document.getElementById('pPrice').value = p? p.price : '';
      document.getElementById('pLink').value = p? p.link : '';
      document.getElementById('pCategory').value = p? p.category : '';
      document.getElementById('pImages').value = p? (p.images||[]).join(', ') : '';
    }
    function closeModal(){ modal.classList.add('hidden'); document.body.style.overflow=''; productForm.reset(); }

    productForm.addEventListener('submit', async (e)=>{
      e.preventDefault();
      const id = document.getElementById('pId').value;
      let images = document.getElementById('pImages').value.split(',').map(x=>x.trim()).filter(x=>x);
      const files = document.getElementById('pFiles').files;
      if(files.length>0){ images = []; for(let f of files){ images.push(await readFileAsDataURL(f)); } }
      const data = { name: document.getElementById('pName').value.trim(), price: document.getElementById('pPrice').value.trim(), link: document.getElementById('pLink').value.trim(), category: document.getElementById('pCategory').value.trim(), images };
      if(!data.name || !data.link){ alert('Please add name and affiliate link'); return; }
      if(id) updateProduct(id, data); else addProduct(data);
      closeModal();
    })

    function readFileAsDataURL(file){ return new Promise((res,rej)=>{ const fr = new FileReader(); fr.onload = ()=>res(fr.result); fr.onerror = rej; fr.readAsDataURL(file); }); }

    // ====== CSV IMPORT ======
    const csvInput = document.getElementById('csvInput'); document.getElementById('importBtn').addEventListener('click', ()=>csvInput.click());
    csvInput.addEventListener('change', async (e)=>{
      const f = e.target.files[0]; if(!f) return; const txt = await f.text(); importCSV(txt); csvInput.value='';
    })

    // CSV format expected: name,price,link,category,images(separated by | or ,)  (header optional)
    function importCSV(text){
      const rows = text.split(/
?
/).map(r=>r.trim()).filter(Boolean);
      let start = 0; if(rows[0].toLowerCase().startsWith('name,')) start = 1;
      const list = loadProducts();
      for(let i=start;i<rows.length;i++){
        const cols = rows[i].split(',').map(c=>c.trim());
        const imgsRaw = cols.slice(4).join(',');
        const imgs = imgsRaw.includes('|') ? imgsRaw.split('|').map(x=>x.trim()) : imgsRaw.split(',').map(x=>x.trim()).filter(x=>x);
        const obj = { id: Date.now().toString()+Math.random().toString(36).slice(2,8), name: cols[0]||'Untitled', price: cols[1]||'', link: cols[2]||'', category: cols[3]||'', images: imgs };
        list.push(obj);
      }
      saveProducts(list); renderProducts(); alert('Imported '+(rows.length-start)+' products');
    }

    // ====== EXPORT ======
    document.getElementById('exportBtn').addEventListener('click', ()=>{
      const data = loadProducts(); const blob = new Blob([JSON.stringify(data, null, 2)],{type:'application/json'}); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href=url; a.download='vd_products.json'; a.click(); URL.revokeObjectURL(url);
    })

    // ====== GALLERY VIEWER ======
    function openGallery(imgs){ if(!imgs||imgs.length===0) return; const viewer=document.createElement('div'); viewer.className='fixed inset-0 bg-black/80 flex items-center justify-center z-50'; const box=document.createElement('div'); box.className='bg-white p-4 rounded max-w-3xl max-h-full overflow-auto'; imgs.forEach(url=>{ const im=document.createElement('img'); im.src=url; im.className='gallery-img'; box.appendChild(im); }); viewer.appendChild(box); viewer.onclick=()=>viewer.remove(); document.body.appendChild(viewer); }

    // initialize
    renderProducts();
  </script>

  <footer class="mt-8 p-4 text-center text-sm text-slate-500">Made with ❤️ — edit this file to change brand, colors, or behavior. Save as <code>index.html</code> and host anywhere.</footer>
</body>
</html>
